<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jhon Salon POS - Pro</title>
    <style>
        :root {
            --primary: #D2B48C; 
            --secondary: #F5F5DC; 
            --dark: #5C4033; 
            --bg: #FFFDD0; 
            --white: #ffffff;
            --accent: #BC8F8F;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--dark);
            margin: 0;
            padding-bottom: 80px;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .container { max-width: 600px; margin: auto; padding: 20px; }
        .page { display: none; }
        .page.active { display: block; }

        .card {
            background: var(--primary);
            color: var(--white);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .box {
            background: var(--white);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--primary);
        }

        h2 { margin-top: 0; border-bottom: 1px solid var(--secondary); padding-bottom: 10px; }

        input, select, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid var(--primary);
            box-sizing: border-box;
            font-size: 16px;
        }

        button { background-color: var(--dark); color: white; border: none; font-weight: bold; cursor: pointer; }
        button:active { transform: scale(0.98); }

        table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; }
        th, td { padding: 8px; border: 1px solid var(--primary); text-align: left; }
        th { background: var(--primary); color: white; }

        .navbar {
            position: fixed; bottom: 0; width: 100%; background: var(--white);
            display: flex; justify-content: space-around; padding: 10px 0;
            border-top: 2px solid var(--primary);
        }

        .nav-item { text-align: center; font-size: 11px; color: var(--dark); cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }

        .label-periode { font-weight: bold; background: var(--secondary); padding: 5px 10px; border-radius: 5px; display: inline-block; margin-bottom: 10px; }
        .btn-del { background: #a32a2a; padding: 4px 8px; font-size: 11px; width: auto; margin: 0; }
        .tgl-txt { font-size: 10px; color: #777; display: block; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0">JHON SALON</h2>
</div>

<div class="container">
    
    <div id="home" class="page active">
        <div class="card">
            <small>Omzet Hari Ini</small>
            <h1 id="dashOmzet">Rp 0</h1>
        </div>
        <div class="box">
            <h3 style="text-align:center; margin-top:0;">Pembayaran Hari Ini</h3>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span>üíµ Cash</span> <b id="dashCash">Rp 0</b></div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span>üì± QRIS</span> <b id="dashQRIS">Rp 0</b></div>
            <div style="display: flex; justify-content: space-between;"><span>üè¶ Transfer</span> <b id="dashTransfer">Rp 0</b></div>
        </div>
    </div>

    <div id="transaksi" class="page">
        <div class="box">
            <h2>Entri Nota Baru</h2>
            <input type="text" id="nama" placeholder="Nama Pelanggan">
            <input type="text" id="layanan" placeholder="Jenis Layanan">
            <input type="number" id="harga" placeholder="Harga (Rp)">
            <select id="metode">
                <option value="Cash">Cash</option>
                <option value="QRIS">QRIS</option>
                <option value="Transfer">Transfer</option>
            </select>
            <button onclick="prosesTransaksi()">Simpan & Cetak (RawBT)</button>
        </div>
        <div class="box">
            <h3>Riwayat Hari Ini</h3>
            <div style="overflow-x:auto">
                <table>
                    <thead><tr><th>Tgl/Nama</th><th>Layanan</th><th>Total</th><th>Aksi</th></tr></thead>
                    <tbody id="listTransaksi"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="biaya" class="page">
        <div class="box">
            <h2>Input Pengeluaran</h2>
            <input type="text" id="ketBiaya" placeholder="Keterangan">
            <input type="number" id="jmlBiaya" placeholder="Nominal (Rp)">
            <button style="background:#555" onclick="simpanBiaya()">Catat Biaya</button>
        </div>
        <div class="box">
            <h3>Riwayat Pengeluaran</h3>
            <div style="overflow-x:auto">
                <table>
                    <thead><tr><th>Tanggal/Ket</th><th>Nominal</th><th>Aksi</th></tr></thead>
                    <tbody id="listBiaya"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="laporan" class="page">
        <div class="box">
            <h2>Laporan Keuangan</h2>
            <div class="label-periode">üìÖ Harian</div>
            <table style="margin-bottom:15px; border:none;">
                <tr><td style="border:none;">Pemasukan</td><td style="text-align:right; border:none;" id="lapDayIn">0</td></tr>
                <tr><td style="border:none;">Pengeluaran</td><td style="text-align:right; border:none;" id="lapDayOut">0</td></tr>
            </table>
            <div class="label-periode">üóìÔ∏è Mingguan</div>
            <table style="margin-bottom:15px; border:none;">
                <tr><td style="border:none;">Pemasukan</td><td style="text-align:right; border:none;" id="lapWeekIn">0</td></tr>
                <tr><td style="border:none;">Pengeluaran</td><td style="text-align:right; border:none;" id="lapWeekOut">0</td></tr>
            </table>
            <div class="label-periode">üè¢ Bulanan</div>
            <table style="margin-bottom:15px; border:none;">
                <tr><td style="border:none;">Pemasukan</td><td style="text-align:right; border:none;" id="lapMonthIn">0</td></tr>
                <tr><td style="border:none;">Pengeluaran</td><td style="text-align:right; border:none;" id="lapMonthOut">0</td></tr>
            </table>
            <hr>
            <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.2em;">
                <span>Total Laba</span><span id="lapTotalLaba" style="color:green;">0</span>
            </div>
        </div>
    </div>

    <div id="setting" class="page">
        <div class="box">
            <h2>Data Management</h2>
            <button onclick="exportData()">Export Backup</button>
            <button onclick="document.getElementById('fileInput').click()" style="background:#8B4513;">Import Restore</button>
            <input type="file" id="fileInput" style="display:none" onchange="importData(event)">
            <button style="background:#a32a2a; margin-top:20px;" onclick="resetData()">Reset Data</button>
        </div>
    </div>
</div>

<div class="navbar">
    <div class="nav-item active" onclick="bukaHalaman('home', this)">üè†<br>Beranda</div>
    <div class="nav-item" onclick="bukaHalaman('transaksi', this)">üìù<br>Transaksi</div>
    <div class="nav-item" onclick="bukaHalaman('biaya', this)">üí∏<br>Biaya</div>
    <div class="nav-item" onclick="bukaHalaman('laporan', this)">üìä<br>Laporan</div>
    <div class="nav-item" onclick="bukaHalaman('setting', this)">‚öôÔ∏è<br>Menu</div>
</div>

<script>
    let dbTx = JSON.parse(localStorage.getItem('js_tx')) || [];
    let dbEx = JSON.parse(localStorage.getItem('js_ex')) || [];

    function formatTgl(ts) {
        const d = new Date(ts);
        return d.toLocaleDateString('id-ID', {day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit'});
    }

    function bukaHalaman(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        updateUI();
    }

    function updateUI() {
        const now = new Date();
        const startOfDay = new Date(now.setHours(0,0,0,0)).getTime();
        const startOfWeek = new Date().getTime() - (7 * 24 * 60 * 60 * 1000);
        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1).getTime();

        let dIn = 0, wIn = 0, mIn = 0, totalIn = 0, c = 0, q = 0, t = 0;
        const listTx = document.getElementById('listTransaksi');
        listTx.innerHTML = '';
        
        dbTx.forEach((x, index) => {
            const hrg = parseInt(x.harga);
            if(x.date >= startOfDay) { 
                dIn += hrg;
                listTx.innerHTML += `<tr><td><span class="tgl-txt">${formatTgl(x.date)}</span>${x.nama}</td><td>${x.layanan}</td><td>${hrg.toLocaleString()}</td><td><button class="btn-del" onclick="hapusTx(${index})">üóëÔ∏è</button></td></tr>`;
                if(x.metode === 'Cash') c += hrg;
                if(x.metode === 'QRIS') q += hrg;
                if(x.metode === 'Transfer') t += hrg;
            }
            if(x.date >= startOfWeek) wIn += hrg;
            if(x.date >= startOfMonth) mIn += hrg;
            totalIn += hrg;
        });

        let dOut = 0, wOut = 0, mOut = 0, totalOut = 0;
        const listEx = document.getElementById('listBiaya');
        listEx.innerHTML = '';
        dbEx.forEach((x, index) => {
            const jml = parseInt(x.jml);
            if(x.date >= startOfDay) dOut += jml;
            if(x.date >= startOfWeek) {
                wOut += jml;
                listEx.innerHTML += `<tr><td><span class="tgl-txt">${formatTgl(x.date)}</span>${x.ket}</td><td>${jml.toLocaleString()}</td><td><button class="btn-del" onclick="hapusEx(${index})">üóëÔ∏è</button></td></tr>`;
            }
            if(x.date >= startOfMonth) mOut += jml;
            totalOut += jml;
        });

        document.getElementById('dashOmzet').innerText = 'Rp ' + dIn.toLocaleString();
        document.getElementById('dashCash').innerText = 'Rp ' + c.toLocaleString();
        document.getElementById('dashQRIS').innerText = 'Rp ' + q.toLocaleString();
        document.getElementById('dashTransfer').innerText = 'Rp ' + t.toLocaleString();
        document.getElementById('lapDayIn').innerText = 'Rp ' + dIn.toLocaleString();
        document.getElementById('lapDayOut').innerText = 'Rp ' + dOut.toLocaleString();
        document.getElementById('lapWeekIn').innerText = 'Rp ' + wIn.toLocaleString();
        document.getElementById('lapWeekOut').innerText = 'Rp ' + wOut.toLocaleString();
        document.getElementById('lapMonthIn').innerText = 'Rp ' + mIn.toLocaleString();
        document.getElementById('lapMonthOut').innerText = 'Rp ' + mOut.toLocaleString();
        document.getElementById('lapTotalLaba').innerText = 'Rp ' + (totalIn - totalOut).toLocaleString();

        localStorage.setItem('js_tx', JSON.stringify(dbTx));
        localStorage.setItem('js_ex', JSON.stringify(dbEx));
    }

    function prosesTransaksi() {
        const n = document.getElementById('nama').value || 'Pelanggan';
        const l = document.getElementById('layanan').value;
        const h = document.getElementById('harga').value;
        const m = document.getElementById('metode').value;
        if(!l || !h) return alert('Layanan/Harga kosong!');
        dbTx.push({nama: n, layanan: l, harga: h, metode: m, date: Date.now()});
        updateUI();
        let teksStruk = "       JHON SALON       \n--------------------------------\nTgl   : " + new Date().toLocaleString() + "\nNama  : " + n + "\n--------------------------------\nLayanan: " + l + "\nTotal  : Rp " + parseInt(h).toLocaleString() + "\nBayar  : " + m + "\n--------------------------------\n   Terima Kasih    \n\n\n";
        window.location.href = "rawbt:base64," + btoa(unescape(encodeURIComponent(teksStruk)));
        document.getElementById('nama').value=''; document.getElementById('layanan').value=''; document.getElementById('harga').value='';
    }

    function simpanBiaya() {
        const k = document.getElementById('ketBiaya').value;
        const j = document.getElementById('jmlBiaya').value;
        if(!k || !j) return;
        dbEx.push({ket: k, jml: j, date: Date.now()});
        updateUI();
        alert('Biaya dicatat!');
        document.getElementById('ketBiaya').value=''; document.getElementById('jmlBiaya').value='';
    }

    function hapusTx(idx) { if(confirm('Hapus?')) { dbTx.splice(idx, 1); updateUI(); } }
    function hapusEx(idx) { if(confirm('Hapus?')) { dbEx.splice(idx, 1); updateUI(); } }
    function exportData() {
        const data = JSON.stringify({tx: dbTx, ex: dbEx});
        const blob = new Blob([data], {type: "application/json"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download = 'backup_jhon_salon.json'; a.click();
    }
    function importData(e) {
        const reader = new FileReader();
        reader.onload = (ev) => { dbTx = JSON.parse(ev.target.result).tx; dbEx = JSON.parse(ev.target.result).ex; updateUI(); alert('Sukses!'); };
        reader.readAsText(e.target.files[0]);
    }
    function resetData() { if(confirm('Hapus semua?')) { localStorage.clear(); location.reload(); } }
    updateUI();
</script>
</body>
</html>
